<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jogo da Cobrinha</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #071422 0%, #051718 100%);
      color: #e6f4ea;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #container { display:flex; flex-direction:column; align-items:center; gap:12px; position: relative; }
    #hud { display:flex; gap:20px; align-items:center; font-weight:700; z-index:2; }
    canvas#game { width: 800px; height: 600px; image-rendering: pixelated; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); border: 4px solid rgba(255,255,255,0.04); background: #071a0f; z-index:1; }
    .stage { position: relative; }
    .overlay { position:absolute; top:0; left:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:12px; width:100%; height:100%; pointer-events:auto; background: rgba(0,0,0,0.45); border-radius:8px; text-align:center; padding:18px; z-index:3; }
    .hidden{ display:none; }
    button{ padding: 10px 18px; border:none; border-radius:8px; background:#16a34a; color:white; font-weight:700; cursor:pointer; box-shadow: 0 6px 18px rgba(0,0,0,0.45); margin-top:10px; }
    button.secondary{ background:#0ea5a6; }
  </style>
</head>
<body>
  <div id="container">
    <div id="hud">
      <div>Pontos: <span id="score">0</span></div>
      <div>Vidas: <span id="lives">3</span></div>
      <div>Recorde: <span id="highscore">0</span></div>
    </div>
    <div class="stage">
      <canvas id="game" width="800" height="600"></canvas>
      <div id="start-screen" class="overlay">
        <h1>Jogo da Cobrinha</h1>
        <p>Use as setas ou WASD para mover. Pressione <strong>R</strong> para reiniciar.</p>
        <button id="startBtn">Start</button>
      </div>
      <div id="msg" class="overlay hidden"></div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const SCALE = 20;
    const COLS = canvas.width / SCALE;
    const ROWS = canvas.height / SCALE;

    let snake = [];
    let dir = { x: 0, y: 0 };
    let nextDir = { x: 0, y: 0 };
    let food = { x: 0, y: 0 };

    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const highscoreEl = document.getElementById('highscore');
    const startScreen = document.getElementById('start-screen');
    const startBtn = document.getElementById('startBtn');
    const msg = document.getElementById('msg');

    let gameInterval = null;
    const TICK_RATE = 150;
    const INITIAL_LIVES = 3;
    const POINTS_PER_FOOD = 10;
    let score = 0;
    let lives = INITIAL_LIVES;
    let highscore = 0;
    let running = false;

    const bgMusic = new Audio('https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Kevin_MacLeod/Happy_Boy/Kevin_MacLeod_-_Happy_Boy.mp3');
    bgMusic.loop = true;
    const eatSound = new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg');
    const winSound = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
    const gameOverSound = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');

    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function resetSnake() {
      snake = [];
      const startX = Math.floor(COLS / 2);
      const startY = Math.floor(ROWS / 2);
      for (let i = 0; i < 4; i++) snake.push({ x: startX - i, y: startY });
      dir = { x: 1, y: 0 };
      nextDir = { x: 1, y: 0 };
    }

    function spawnFood() {
      do { food.x = randInt(0, COLS - 1); food.y = randInt(0, ROWS - 1); } while (snake.some(s => s.x === food.x && s.y === food.y));
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#052310';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.fillStyle = '#ff4157';
      ctx.arc(food.x * SCALE + SCALE / 2, food.y * SCALE + SCALE / 2, SCALE * 0.4, 0, Math.PI * 2);
      ctx.fill();
      snake.forEach((part, i) => {
        ctx.fillStyle = i === 0 ? '#9fffa3' : '#28a745';
        ctx.fillRect(part.x * SCALE, part.y * SCALE, SCALE, SCALE);
      });
    }

    function update() {
      dir = nextDir;
      const newHead = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
      if (newHead.x < 0 || newHead.x >= COLS || newHead.y < 0 || newHead.y >= ROWS || snake.some(seg => seg.x === newHead.x && seg.y === newHead.y)) {
        handleDeath();
        return;
      }
      snake.unshift(newHead);
      if (newHead.x === food.x && newHead.y === food.y) {
        score += POINTS_PER_FOOD;
        scoreEl.textContent = score;
        eatSound.currentTime = 0; eatSound.play();
        spawnFood();
      } else {
        snake.pop();
      }
      draw();
      if (snake.length >= COLS * ROWS) { clearInterval(gameInterval); running = false; bgMusic.pause(); winSound.play(); showMessage(`Você venceu! Pontos: ${score}`, true); }
    }

    function handleDeath() {
      clearInterval(gameInterval);
      running = false;
      lives -= 1;
      livesEl.textContent = lives;
      if (lives > 0) {
        showTempMessage(`Você perdeu uma vida! Vidas restantes: ${lives}`, 900, () => { resetSnake(); spawnFood(); draw(); startLoop(); });
      } else {
        bgMusic.pause(); gameOverSound.play();
        if (score > highscore) { highscore = score; highscoreEl.textContent = highscore; }
        showMessage(`Game Over! Você fez ${score} pontos.`, false);
      }
    }

    function showTempMessage(text, duration = 900, cb) {
      msg.textContent = text; msg.classList.remove('hidden');
      setTimeout(() => { msg.classList.add('hidden'); if (cb) cb(); }, duration);
    }

    function showMessage(text, isWin = false) {
      msg.innerHTML = `<div><strong>${isWin ? 'Vitória' : 'Game Over'}</strong><br>${text}<br>Recorde atual: ${highscore}</div><button id="restartBtn" class="secondary">Reiniciar</button>`;
      msg.classList.remove('hidden');
      document.getElementById('restartBtn').addEventListener('click', () => {
        score = 0; lives = INITIAL_LIVES; scoreEl.textContent = score; livesEl.textContent = lives;
        msg.classList.add('hidden'); startScreen.classList.remove('hidden');
      });
    }

    function startLoop() { if (running) return; clearInterval(gameInterval); gameInterval = setInterval(update, TICK_RATE); running = true; }

    function startGame() {
      startScreen.classList.add('hidden');
      score = 0; lives = INITIAL_LIVES; scoreEl.textContent = score; livesEl.textContent = lives;
      resetSnake(); spawnFood(); draw(); bgMusic.currentTime = 0; bgMusic.play(); startLoop();
    }

    startBtn.addEventListener('click', startGame);
    window.addEventListener('keydown', e => {
      switch(e.key){
        case 'ArrowUp': case 'w': case 'W': if(dir.y!==1) nextDir={x:0,y:-1}; break;
        case 'ArrowDown': case 's': case 'S': if(dir.y!==-1) nextDir={x:0,y:1}; break;
        case 'ArrowLeft': case 'a': case 'A': if(dir.x!==1) nextDir={x:-1,y:0}; break;
        case 'ArrowRight': case 'd': case 'D': if(dir.x!==-1) nextDir={x:1,y:0}; break;
        case 'r': case 'R': startGame(); break;
      }
    });

    resetSnake(); spawnFood(); draw();
  </script>
</body>
</html>